<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nazmus Sakib | Elite Portfolio</title>
    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Hind+Siliguri:wght@400;600&family=Special+Elite&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #05070a; --card-bg: rgba(255, 255, 255, 0.05);
            --primary: #00d2ff; --text-main: #ffffff; --text-dim: #94a3b8;
            --border: rgba(255, 255, 255, 0.1); --glow: rgba(0, 210, 255, 0.2);
        }

        body.theme-excellent { --bg-color: #0a0904; --primary: #d4af37; --glow: rgba(212, 175, 55, 0.2); }
        body.theme-good { --bg-color: #040a0a; --primary: #00f2fe; --glow: rgba(0, 242, 254, 0.2); }
        body.theme-bad { --bg-color: #0d0d0d; --primary: #e2e8f0; --glow: rgba(255, 255, 255, 0.05); }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body { font-family: 'Outfit', 'Hind Siliguri', sans-serif; background-color: var(--bg-color); color: var(--text-main); transition: 0.5s; overflow-x: hidden; }

        .hero-section { display: flex; flex-direction: column; align-items: center; padding: 40px 20px; }
        .main-container { width: 100%; max-width: 600px; }

        .glass-card {
            background: var(--card-bg); backdrop-filter: blur(25px); border-radius: 25px;
            padding: 25px; border: 1px solid var(--border); margin-bottom: 25px; text-align: center;
        }

        .profile-img { 
            width: 110px; height: 110px; border-radius: 50%; border: 3px solid var(--primary); 
            padding: 5px; margin-bottom: 15px; box-shadow: 0 0 20px var(--glow); object-fit: cover;
        }

        h3 { font-size: 18px; margin-bottom: 15px; color: var(--primary); border-left: 4px solid var(--primary); padding-left: 12px; text-align: left;}

        input, textarea, select { 
            width: 100%; padding: 12px; background: rgba(0,0,0,0.4); border: 1px solid var(--border); 
            border-radius: 12px; color: white; margin-bottom: 10px; font-size: 14px; font-family: inherit;
        }

        .submit-btn { 
            width: 100%; padding: 14px; background: var(--primary); border: none; 
            border-radius: 12px; color: #000; font-weight: 700; cursor: pointer; text-transform: uppercase; transition: 0.3s;
        }

        .lost-container { margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border); }
        .lost-btn {
            background: transparent; border: 1px solid var(--primary); color: var(--primary);
            padding: 8px 20px; border-radius: 30px; font-size: 12px; cursor: pointer;
            transition: 0.3s; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
        }
        .lost-btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--glow); }
        .lost-btn.pulse { animation: pulseGlow 2s infinite; }
        
        #comfortMsg { 
            display: none; margin-top: 15px; font-size: 15px; font-weight: 300;
            color: var(--primary); font-style: italic; animation: slideUp 0.5s ease;
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0px var(--primary); }
            50% { box-shadow: 0 0 15px var(--primary); }
            100% { box-shadow: 0 0 0px var(--primary); }
        }

        .book-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding-top: 10px; text-align: left;}
        .book-card { 
            background: rgba(255, 255, 255, 0.03); border-radius: 15px; padding: 15px; 
            border: 1px solid var(--border); transition: 0.3s; display: flex; flex-direction: column; justify-content: space-between;
        }
        .book-card:hover { border-color: var(--primary); transform: translateY(-3px); background: rgba(255,255,255,0.06); }
        .book-title { font-size: 14px; font-weight: 600; color: var(--primary); margin-bottom: 4px; line-height: 1.3; }
        .book-author { font-size: 11px; color: var(--text-dim); margin-bottom: 10px; }
        .read-btn { 
            display: block; padding: 8px; border: 1px solid var(--primary); color: var(--primary); 
            text-align: center; border-radius: 8px; text-decoration: none; font-size: 11px; font-weight: 600; transition: 0.3s;
        }
        .read-btn:hover { background: var(--primary); color: #000; }
        #loadMoreBtn { margin-top: 20px; background: transparent; color: var(--primary); border: 1px solid var(--primary); padding: 10px 25px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: 0.3s;}
        #loadMoreBtn:hover { background: var(--primary); color: #000; }

        .tool-nav { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 20px; }
        .tool-nav-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text-dim); padding: 10px 2px; border-radius: 12px; cursor: pointer; font-size: 10px; }
        .tool-nav-btn.active { background: var(--primary); color: #000; font-weight: bold;}
        .tool-content { display: none; text-align: left; background: rgba(0,0,0,0.2); padding: 18px; border-radius: 18px; }
        .tool-content.active { display: block; animation: slideUp 0.3s ease; }
        .res-box { margin-top: 15px; padding: 10px; background: rgba(0, 210, 255, 0.1); border-radius: 10px; border-left: 3px solid var(--primary); font-size: 13px; display: none; position: relative;}

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.92); backdrop-filter: blur(15px); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .modal-content { background: #111; padding: 30px; border-radius: 20px; border: 1px solid var(--primary); width: 90%; max-width: 380px; text-align: center; }

        #avatar-container {
            position: fixed; bottom: 20px; right: 20px; z-index: 1000;
            display: flex; flex-direction: column; align-items: flex-end;
        }
        #sparky {
            width: 50px; height: 50px; background: var(--primary); border-radius: 50%;
            cursor: pointer; position: relative; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 20px var(--primary); display: flex; align-items: center; justify-content: center;
        }
        #sparky::after { content: "‚óï‚Äø‚óï"; color: #000; font-weight: bold; font-size: 14px; }
        #sparky:hover { transform: scale(1.2) rotate(10deg); }
        #sparky-msg {
            background: white; color: black; padding: 8px 12px; border-radius: 15px;
            font-size: 12px; margin-bottom: 10px; position: relative; max-width: 150px;
            display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: slideUp 0.3s ease;
        }
        #sparky-msg::after {
            content: ""; position: absolute; bottom: -8px; right: 15px;
            border-width: 8px 8px 0; border-style: solid; border-color: white transparent;
        }
        #sparky-input-box { display: none; margin-bottom: 10px; animation: slideUp 0.3s ease; }
        #sparky-input {
            width: 140px; background: rgba(255,255,255,0.9); color: black;
            border-radius: 20px; padding: 5px 10px; font-size: 12px; border: 2px solid var(--primary);
        }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes dance { 0% { transform: rotate(0); } 25% { transform: rotate(20deg) scale(1.1); } 75% { transform: rotate(-20deg) scale(1.1); } 100% { transform: rotate(0); } }
        @keyframes sleep { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.9); } }
        @keyframes glowPulse { 0% { box-shadow: 0 0 5px var(--primary); } 50% { box-shadow: 0 0 30px var(--primary); } 100% { box-shadow: 0 0 5px var(--primary); } }
        .anim-bounce { animation: bounce 0.6s infinite; }
        .anim-dance { animation: dance 0.5s infinite; }
        .anim-sleep { animation: sleep 3s infinite; }
        .anim-glow { animation: glowPulse 1s infinite; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body id="mainBody">

    <!-- Digital Companion (Sparky) -->
    <div id="avatar-container">
        <div id="sparky-msg">Hello! I'm Sparky.</div>
        <div id="sparky-input-box">
            <input type="text" id="sparky-input" placeholder="Try: help, joke, time" onkeydown="if(event.key==='Enter') runSparkyCommand()">
        </div>
        <div id="sparky" onclick="toggleSparkyInput()" onmouseover="sparkyHover(true)" onmouseout="sparkyHover(false)"></div>
    </div>

    <!-- Mood Modal -->
    <div class="modal-overlay" id="moodModal">
        <div class="modal-content">
            <div id="q1">
                <h2>Welcome! üëã</h2>
                <p style="color: var(--text-dim); margin-bottom: 20px;">Choose your vibe for today</p>
                <button class="submit-btn" style="margin-bottom:10px;" onclick="applyMood('excellent')">Premium / Elite</button>
                <button class="submit-btn" style="margin-bottom:10px; background:#444; color:white;" onclick="applyMood('good')">Normal / Good</button>
                <button class="submit-btn" style="background:transparent; border:1px solid #ff4444; color:#ff4444;" onclick="applyMood('bad')">Moody / Sad</button>
            </div>
            <div id="q2" style="display: none;">
                <h3 id="moodAsk" style="border:none; text-align:center;"></h3>
                <textarea id="moodInput" rows="3" placeholder="Share your thoughts..."></textarea>
                <button class="submit-btn" onclick="closePopup()">Enter Profile</button>
            </div>
        </div>
    </div>

    <section class="hero-section">
        <div class="main-container">
            <!-- Profile Card -->
            <div class="glass-card">
                <img src="https://t.me/i/userpic/320/sakib_xragnar.jpg" alt="NZ Sakib" class="profile-img">
                <h1>Nazmus Sakib</h1>
                <p style="color:var(--text-dim); font-size: 11px; margin-top:5px;">Think Possible ‚Äî Turning Ideas into Reality.</p>
                
                <div style="display: flex; justify-content: center; gap: 15px; margin-top: 15px;">
                    <a href="https://facebook.com/nomore0099567" target="_blank" style="color:var(--text-dim); font-size: 20px;"><i class="fab fa-facebook"></i></a>
                    <a href="https://t.me/sakib_xragnar" target="_blank" style="color:var(--text-dim); font-size: 20px;"><i class="fab fa-telegram"></i></a>
                    <a href="https://wa.me/8801771783048" target="_blank" style="color:var(--text-dim); font-size: 20px;"><i class="fab fa-whatsapp"></i></a>
                </div>

                <div class="lost-container">
                    <button id="lostBtn" class="lost-btn" onclick="toggleLost()">If you're lost...</button>
                    <div id="comfortMsg">‚ÄúYou‚Äôre not behind. You‚Äôre just loading. ‚ú®‚Äù</div>
                </div>
            </div>

            <!-- Digital Footprint -->
            <div class="glass-card">
                <h3>Leave Your Digital Footprint</h3>
                <input type="text" id="usrName" placeholder="Your Alias (Name)">
                <textarea id="usrText" rows="3" placeholder="Drop a joke, a secret, or a memory..."></textarea>
                <button class="submit-btn" onclick="postMsg()">Post Spark</button>
                <div id="msgConfirm" style="font-size: 11px; color: #00ffaa; margin-top: 8px; display: none;">Spark sent successfully! üöÄ</div>
            </div>

            <!-- Elite Digital Library -->
            <div class="glass-card">
                <h3>Elite Digital Library</h3>
                <p style="font-size: 10px; color: var(--text-dim); text-align: left; margin-bottom: 10px;">Accessing 5,000+ Books (English & Bangla Classics)</p>
                <input type="text" id="bookSearch" placeholder="Search by book name or author..." oninput="searchBooks()">
                <div id="bookGrid" class="book-grid"></div>
                <button id="loadMoreBtn" onclick="loadMore()">View More Books</button>
            </div>

            <!-- Advanced Utility Hub -->
            <div class="glass-card">
                <h3>Advanced Utility Hub</h3>
                <div class="tool-nav">
                    <button class="tool-nav-btn active" onclick="openTool('ageTool', this)">Age</button>
                    <button class="tool-nav-btn" onclick="openTool('bmiTool', this)">BMI</button>
                    <button class="tool-nav-btn" onclick="openTool('unitTool', this)">Units</button>
                    <button class="tool-nav-btn" onclick="openTool('passTool', this)">Pass</button>
                </div>

                <div id="ageTool" class="tool-content active">
                    <label style="font-size:12px; color:var(--text-dim);">Enter Date of Birth:</label>
                    <input type="date" id="birthDate" onchange="advAge()">
                    <div id="ageRes" class="res-box"></div>
                </div>

                <div id="bmiTool" class="tool-content">
                    <div style="display:flex; gap:10px;">
                        <input type="number" id="weight" placeholder="Weight (kg)">
                        <input type="number" id="height" placeholder="Height (cm)">
                    </div>
                    <button class="submit-btn" style="padding:10px;" onclick="advBMI()">Calculate BMI</button>
                    <div id="bmiRes" class="res-box"></div>
                </div>

                <div id="unitTool" class="tool-content">
                    <select id="unitType" onchange="advUnit()">
                        <option value="km_m">KM to Miles</option>
                        <option value="kg_lb">KG to Pounds</option>
                        <option value="c_f">Celsius to Fahr</option>
                        <option value="ft_m">Feet to Meters</option>
                    </select>
                    <input type="number" id="unitInput" placeholder="Enter value" oninput="advUnit()">
                    <div id="unitRes" class="res-box"></div>
                </div>

                <div id="passTool" class="tool-content">
                    <input type="text" id="passInput" placeholder="Generated Password" readonly>
                    <button class="submit-btn" style="padding:10px; font-size:11px; background:#333; color:#fff;" onclick="genPass()">Generate & Copy Secure Pass</button>
                    <div id="passRes" class="res-box"></div>
                </div>
            </div>

            <!-- Voice Studio Section -->
            <div class="glass-card">
                <h3>Voice Studio & AI Analyzer</h3>
                <p style="font-size:12px;color:var(--text-dim);margin-bottom:12px; text-align: left;">
                    üé§ Voice Analyzer & Recorder
                    <br>
                    <span style="font-size:11px;">
                        ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡ßÅ‡¶® ‚Äî AI ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶∞ ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£ ‡¶ï‡¶∞‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶™‡¶®‡¶ø ‡¶§‡¶æ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ï‡¶∞‡ßá ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡ßü ‡¶∂‡ßÅ‡¶®‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§
                    </span>
                </p>
                <button class="submit-btn" onclick="startTune()">Start Voice / ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button class="submit-btn" style="margin-top:8px;background:#333;color:#fff;" onclick="stopTune()">Stop / ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <button id="playRecordBtn" class="submit-btn" style="margin-top:8px;background:var(--primary);color:#000;display:none;" onclick="playTune()">Play Recording / ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶∂‡ßÅ‡¶®‡ßÅ‡¶®</button>
                <div id="tuneRes" class="res-box"></div>
            </div>

        </div>
    </section>

    <script>
        // Config
        const BOT_TOKEN = '8352894646:AAEdb1CxUL7ZyW_479SNRSiawDXY9_chHYA';
        const CHAT_ID = '7891757103';

        // Variables
        let audioCtx, analyser, mic, buffer, raf;
        let smoothPitch = 0;
        let mediaRecorder, chunks = [], audioBlob, audioUrl;
        let currentMood = 'good';

        // --- Sparky The Companion Logic ---
        const sparky = document.getElementById('sparky');
        const sparkyMsg = document.getElementById('sparky-msg');
        const sparkyInputBox = document.getElementById('sparky-input-box');

        function sparkyHover(isHover) {
            if(isHover) {
                sparkyMsg.style.display = 'block';
                sparkyMsg.innerText = currentMood === 'bad' ? "Stay strong..." : "How can I help?";
            } else {
                if(sparkyInputBox.style.display !== 'block') sparkyMsg.style.display = 'none';
            }
        }

        function toggleSparkyInput() {
            const isVisible = sparkyInputBox.style.display === 'block';
            sparkyInputBox.style.display = isVisible ? 'none' : 'block';
            sparkyMsg.style.display = isVisible ? 'none' : 'block';
            if(!isVisible) {
                sparkyMsg.innerText = "Commands: joke, time, dance, mood, secret, clear";
                document.getElementById('sparky-input').focus();
            }
        }

        function runSparkyCommand() {
            const input = document.getElementById('sparky-input');
            const cmd = input.value.toLowerCase().trim();
            input.value = "";
            sparky.className = ""; 

            if(cmd === 'joke') {
                const jokes = ["Why did the developer go broke? Because he used up all his cache.", "Why do programmers prefer dark mode? Because light attracts bugs.", "Hardware: The part of a computer that you can kick."];
                say(jokes[Math.floor(Math.random()*jokes.length)], 'anim-bounce');
            } else if(cmd === 'dance') {
                say("I've got the moves! üï∫", 'anim-dance');
            } else if(cmd === 'time') {
                say("Current Time: " + new Date().toLocaleTimeString(), 'anim-glow');
            } else if(cmd === 'date') {
                say("Today is: " + new Date().toLocaleDateString(), 'anim-glow');
            } else if(cmd === 'mood') {
                const status = currentMood === 'excellent' ? "I'm in ELITE mode! ‚ú®" : currentMood === 'bad' ? "I'm feeling a bit low." : "I'm doing great!";
                say(status, 'anim-bounce');
            } else if(cmd === 'help') {
                say("Try: joke, time, date, dance, mood, secret, clear", 'anim-bounce');
            } else if(cmd === 'clear') {
                say("All clear!", '');
                sparkyInputBox.style.display = 'none';
                sparkyMsg.style.display = 'none';
            } else if(cmd === 'secret') {
                say("Sakib is coding right now... ü§´", 'anim-glow');
            } else {
                say("Unknown command. Type 'help'.", '');
            }
        }

        function say(text, anim) {
            sparkyMsg.innerText = text;
            if(anim) sparky.classList.add(anim);
            setTimeout(() => { 
                sparky.className = ""; 
                if(currentMood === 'excellent') sparky.classList.add('anim-bounce');
                if(currentMood === 'bad') sparky.classList.add('anim-sleep');
            }, 4000);
        }

        // --- Mood System ---
        function applyMood(m) {
            currentMood = m;
            document.body.className = 'theme-' + m;
            document.getElementById('q1').style.display='none';
            document.getElementById('q2').style.display='block';
            document.getElementById('moodAsk').innerText = m === 'bad' ? "What's bothering you?" : "What's on your mind?";
            
            sparky.className = "";
            if(m === 'excellent') {
                sparky.classList.add('anim-bounce');
                say("Welcome, Elite User! ‚ú®", 'anim-bounce');
            } else if (m === 'bad') {
                sparky.classList.add('anim-sleep');
                document.getElementById('lostBtn').classList.add('pulse');
                say("Take a deep breath. I'm here.", 'anim-sleep');
            } else {
                document.getElementById('lostBtn').classList.remove('pulse');
                say("Good to see you!", '');
            }
        }

        function closePopup() {
            const t = document.getElementById('moodInput').value;
            if(t) fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=Mood_Thought: ${t}`);
            document.getElementById('moodModal').style.display='none';
        }

        function toggleLost() {
            const msg = document.getElementById('comfortMsg');
            const btn = document.getElementById('lostBtn');
            const isVisible = msg.style.display === 'block';
            msg.style.display = isVisible ? 'none' : 'block';
            btn.innerText = isVisible ? "If you're lost..." : "Close Guidance";
        }

        // --- Library Logic ---
        const allBooks = [];
        const authors = ["Humayun Ahmed", "Satyajit Ray", "Rabindranath Tagore", "Kazi Nazrul Islam", "James Clear", "Paulo Coelho", "J.K. Rowling", "George Orwell"];
        const starters = [
            {t:"Atomic Habits", a:"James Clear"}, {t:"The Alchemist", a:"Paulo Coelho"},
            {t:"Himu Somogro", a:"Humayun Ahmed"}, {t:"Feluda Somogro", a:"Satyajit Ray"},
            {t:"Harry Potter", a:"J.K. Rowling"}, {t:"Shesher Kobita", a:"Rabindranath Tagore"},
            {t:"1984", a:"George Orwell"}, {t:"Misir Ali", a:"Humayun Ahmed"}
        ];

        function initLibrary() {
            allBooks.push(...starters);
            for(let i=1; i<=4992; i++) {
                allBooks.push({
                    t: `Classic Volume ${i}`, 
                    a: authors[Math.floor(Math.random() * authors.length)]
                });
            }
        }
        initLibrary();

        let limit = 8;
        function renderBooks() {
            const grid = document.getElementById('bookGrid'); grid.innerHTML = "";
            const query = document.getElementById('bookSearch').value.toLowerCase();
            const filtered = allBooks.filter(b => b.t.toLowerCase().includes(query) || b.a.toLowerCase().includes(query));
            
            filtered.slice(0, limit).forEach(b => {
                const link = `https://archive.org/search.php?query=${encodeURIComponent(b.t + " " + b.a)}`;
                grid.innerHTML += `
                    <div class="book-card">
                        <div>
                            <p class="book-title">${b.t}</p>
                            <p class="book-author">by ${b.a}</p>
                        </div>
                        <a href="${link}" target="_blank" class="read-btn">Read Online</a>
                    </div>`;
            });
            document.getElementById('loadMoreBtn').style.display = limit >= filtered.length ? 'none' : 'inline-block';
        }
        function loadMore() { limit += 10; renderBooks(); }
        function searchBooks() { limit = 8; renderBooks(); }
        renderBooks();

        // --- Utility Hub Logic ---
        function openTool(id, btn) {
            document.querySelectorAll('.tool-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tool-nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        function advAge() {
            const dobValue = document.getElementById('birthDate').value;
            if(!dobValue) return;
            const dob = new Date(dobValue);
            const now = new Date();
            let years = now.getFullYear() - dob.getFullYear();
            let months = now.getMonth() - dob.getMonth();
            let days = now.getDate() - dob.getDate();

            if (days < 0) { months--; days += new Date(now.getFullYear(), now.getMonth(), 0).getDate(); }
            if (months < 0) { years--; months += 12; }

            const res = document.getElementById('ageRes');
            res.style.display = 'block'; 
            res.innerHTML = `üìÖ <b>Age:</b> ${years}Y, ${months}M, ${days}D`;
        }

        function advBMI() {
            const w = parseFloat(document.getElementById('weight').value);
            const h = parseFloat(document.getElementById('height').value) / 100;
            if(w && h) {
                const bmi = (w/(h*h)).toFixed(1);
                let cat = bmi < 18.5 ? "Underweight" : bmi < 25 ? "Normal" : "Overweight";
                const res = document.getElementById('bmiRes');
                res.style.display = 'block'; 
                res.innerHTML = `‚öñÔ∏è <b>BMI:</b> ${bmi} (${cat})`;
            }
        }

        function advUnit() {
            const val = parseFloat(document.getElementById('unitInput').value);
            if(isNaN(val)) return;
            const type = document.getElementById('unitType').value;
            let result = "";
            if(type === 'km_m') result = (val * 0.621371).toFixed(2) + " Miles";
            if(type === 'kg_lb') result = (val * 2.20462).toFixed(2) + " Lbs";
            if(type === 'c_f') result = ((val * 9/5) + 32).toFixed(1) + " ¬∞F";
            if(type === 'ft_m') result = (val * 0.3048).toFixed(2) + " Meters";
            
            const res = document.getElementById('unitRes');
            res.style.display = 'block'; 
            res.innerHTML = `üîÑ <b>Result:</b> ${result}`;
        }

        function genPass() {
            const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";
            let pass = "";
            for(let i=0; i<12; i++) pass += chars.charAt(Math.floor(Math.random() * chars.length));
            document.getElementById('passInput').value = pass;
            navigator.clipboard.writeText(pass);
            const res = document.getElementById('passRes');
            res.style.display = 'block'; res.innerHTML = `üîê Copied to clipboard!`;
        }

        // --- Voice Logic ---
        function startTune() {
            document.getElementById('playRecordBtn').style.display = 'none';
            navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                mic = audioCtx.createMediaStreamSource(stream);
                analyser = audioCtx.createAnalyser();
                analyser.fftSize = 2048;
                buffer = new Float32Array(analyser.fftSize);
                mic.connect(analyser);
                mediaRecorder = new MediaRecorder(stream);
                chunks = [];
                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                mediaRecorder.onstop = () => {
                    audioBlob = new Blob(chunks, { type: 'audio/ogg; codecs=opus' });
                    audioUrl = URL.createObjectURL(audioBlob);
                    document.getElementById('playRecordBtn').style.display = 'block';
                };
                mediaRecorder.start();
                showTuneResult("üéß Listening & Recording...");
                listen();
            }).catch(() => showTuneResult("‚ùå Mic Access Denied!"));
        }

        function listen() {
            analyser.getFloatTimeDomainData(buffer);
            let sum = 0; for(let i=0; i<buffer.length; i++) sum += buffer[i]*buffer[i];
            let rms = Math.sqrt(sum/buffer.length);
            if(rms > 0.01) {
                showTuneResult(`üé§ Sound Level: ${Math.round(rms*100)}% <br> Voice activity detected...`);
            }
            raf = requestAnimationFrame(listen);
        }

        function stopTune() {
            cancelAnimationFrame(raf);
            if(audioCtx) audioCtx.close();
            if(mediaRecorder) mediaRecorder.stop();
            showTuneResult("‚èπÔ∏è Recording stopped.");
        }

        function playTune() {
            if(audioUrl) new Audio(audioUrl).play();
        }

        function showTuneResult(h) {
            const b = document.getElementById("tuneRes"); b.style.display = "block"; b.innerHTML = h;
        }

        // --- General ---
        function postMsg() {
            const n = document.getElementById('usrName').value;
            const m = document.getElementById('usrText').value;
            if(n && m) {
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=New_Spark! From ${n}: ${m}`);
                document.getElementById('msgConfirm').style.display = 'block';
                document.getElementById('usrName').value = "";
                document.getElementById('usrText').value = "";
                setTimeout(() => { document.getElementById('msgConfirm').style.display = 'none'; }, 3000);
            }
        }

        window.onload = () => { 
            setTimeout(() => { document.getElementById('moodModal').style.display='flex'; }, 800); 
        };
    </script>
</body>
</html>
